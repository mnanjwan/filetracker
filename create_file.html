<!doctype html>

<html lang="en" data-layout="horizontal" data-layout-style="default" data-layout-position="fixed" data-topbar="light"
    data-sidebar-visibility="show" data-sidebar="light" data-sidebar-size="lg" data-bs-theme="light"
    data-layout-width="fluid" data-preloader="disable">

<head>

    <meta charset="utf-8" />
    <title>FileTrakA</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="FileTrakA" name="description" />
    <!-- App favicon -->
    <link rel="shortcut icon" href="assets/images/favicon.ico">
    <!-- Style css -->

    <!-- jsvectormap css -->
    <link href="assets/libs/jsvectormap/css/jsvectormap.min.css" rel="stylesheet" type="text/css" />

    <!--Swiper slider css-->
    <link href="assets/libs/swiper/swiper-bundle.min.css" rel="stylesheet" type="text/css" />

    <!-- Layout config Js -->
    <script src="assets/js/layout.js"></script>
    <!-- Bootstrap Css -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <!-- Icons Css -->
    <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css" />
    <!-- App Css-->
    <link href="assets/css/app.min.css" rel="stylesheet" type="text/css" />
    <!-- custom Css-->
    <link href="assets/css/custom.min.css" rel="stylesheet" type="text/css" />
    <!-- MDB icon -->
    <link rel="icon" href="img/mdb-favicon.ico" type="image/x-icon" />
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css" />
    <!-- Google Fonts Roboto -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap" />
    <!-- MDB -->
    <link rel="stylesheet" href="css/bootstrap-video-carousel.min.css" />

    <style>
        
      /* General styles for the result message */
      #file-id-result {
        font-size: 16px;
        margin-top: 15px;
        padding: 10px;
        border-radius: 5px;
        display: none; /* Hidden by default */
      }

      /* Success message styles */
      #file-id-result.success {
        color: #4CAF50;
        border: 1px solid #4CAF50;
      }

      /* Error message styles */
      #file-id-result.error {
        color: #f44336;
        border: 1px solid #f44336;
      }
  
        .navbar .nav-link {
          color: #fff !important;
        }
      </style>


</head>

<body>

    <!-- Begin page -->
    <div id="layout-wrapper">


        <!-- Navigation Links -->
        <div style="width: 100%; top: 0;" id="navbar-container"></div>
        
        <!-- Left Sidebar End -->
        <!-- Vertical Overlay-->
        <div class="vertical-overlay"></div>
<!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">

                    <div class="row">
                        <div class="col">

                            <div class="h-100">


                                <div class="row">
                                    <div class="col-lg-5 mx-auto">
                                        <div class="card">
                                            <div class="card-header align-items-center d-flex"
                                                style="background-color: #0b6528;">
                                                <h4 style="color: #ffffff;" class="card-title mb-0 flex-grow-1">Create
                                                    New File</h4>

                                            </div><!-- end card header -->
                                            <div class="card-body">
                                                <div class="live-preview">
                                                    <form class="login100-form validate-form" id="generate-file-form">
                                                        <div class="row gy-4">
                                                            <div class="col-xxl-3 col-md-12">
                                                                <div>
                                                                    <label for="file_num" class="form-label">File Number</label>
                                                                    <input type="text" class="form-control" id="file_num" placeholder="File Number" value="NCS-" required>
                                                                </div>
                                                            </div>
                                            
                                                            <div class="col-xxl-3 col-md-12">
                                                                <div>
                                                                    <label for="current-location" class="form-label">Sending From</label>
                                                                    <input type="text" class="form-control" id="current-location" value="LEGAL SEAT" readonly>
                                                                </div>
                                                            </div>
                                            
                                                            <div class="col-xxl-3 col-md-12">
                                                                <div>
                                                                    <label for="sending-to-command">Select Command</label>
                                                                    <select class="form-select mb-3" id="users-command" required>
                                                                        <option value="">Select Command</option>
                                                                        <!-- Populate dynamically -->
                                                                    </select>
                                                                </div>
                                                            </div>
                                            
                                                            <div class="col-xxl-3 col-md-12">
                                                                <div>
                                                                    <label for="sending-to">Sending To</label>
                                                                    <select class="form-select mb-3" id="sending-to" required>
                                                                        <option value="">Select Unit</option>
                                                                    </select>
                                                                    <input type="text" class="form-control" id="create-new-unit" placeholder="New Unit Name" style="display: none; margin-top: 10px;">
                                                                </div>
                                                            </div>
                                            
                                                            <div class="col-xxl-3 col-md-12">
                                                                <div>
                                                                    <label for="file-status">Precedence Marking</label>
                                                                    <select class="form-select mb-3" id="file-status" required>
                                                                        <option selected>Precedence Marking</option>
                                                                        <option value="Immediate">Immediate</option>
                                                                        <option value="Priority">Priority</option>
                                                                        <option value="Normal">Normal</option>
                                                                    </select>
                                                                </div>
                                                            </div>
                                            
                                                            <div class="col-xxl-3 col-md-12">
                                                                <div>
                                                                    <label for="description" class="form-label">File Description</label>
                                                                    <textarea class="form-control" id="description" rows="3" placeholder="Enter File Description" required></textarea>
                                                                </div>
                                                            </div>
                                            
                                                            <div class="edit">
                                                                <button class="btn btn-lg" style="background-color: grey; color: white;" onmouseover="this.style.backgroundColor='#0b6528';" onmouseout="this.style.backgroundColor='grey';" type="submit">
                                                                    Create File
                                                                </button>
                                                            </div>
                                                            <div style="width: 100%" id="file-id-result"></div>
                                                        </div>
                                                    </form>
                                                </div>
                                            </div>
                                            
                                        </div>
                                    </div>
                                    <!--end col-->
                                </div>

                            </div> <!-- end .h-100-->

                        </div> <!-- end col -->


                    </div>

                </div>
                <!-- container-fluid -->
            </div>
            <!-- End Page-content -->

            <footer class="footer">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-sm-6">
                            <script>document.write(new Date().getFullYear())</script> © FileTrakA | Nigeria Customs Service | All rights reserved | Powered by ED Antia psc Assistant Comptroller of Customs.
                        </div>
                        <div class="col-sm-6">
                            <div class="text-sm-end d-none d-sm-block">
                                <a href="">FAQ</a>
                            </div>
                        </div>
                    </div>
                </div>
            </footer>
        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->




    <!--start back-to-top-->
    <button onclick="topFunction()" class="btn btn-danger btn-icon" id="back-to-top">
        <i class="ri-arrow-up-line"></i>
    </button>
    <!--end back-to-top-->

    <!--preloader-->
    <div id="preloader">
        <div id="status">
            <div class="spinner-border text-primary avatar-sm" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>
    </div>



    <!-- JAVASCRIPT -->
    <script src="js/main.js"></script>
    <script src="js/commands.js"></script>
	<script>
        document.addEventListener('DOMContentLoaded', function () {
        // Handle logout function
        function handleLogout(event) {
            event.preventDefault(); // Prevent default anchor action
            console.log('Logout button clicked'); // Debug log to confirm click event

            // Show confirmation dialog
            const userConfirmed = window.confirm("Are you sure you want to log out?");

            if (userConfirmed) {
                console.log('User confirmed logout');

                // Clear all localStorage items
                localStorage.clear();
                console.log("Local storage cleared. User logged out.");

                // Redirect to index page
                window.location.href = "./index.html"; 
            } else {
                console.log("Logout canceled by the user.");
            }
        }

        const welcomeLoginMessage = document.getElementById('welcome-message-service-number');
        const authToggleLink = document.getElementById('auth-toggle-link');
        const authToggleIcon = document.getElementById('auth-toggle-icon');
        const toggleInstance = document.getElementById('toggle-instance');

        // Check for user data in localStorage
        let userData = JSON.parse(localStorage.getItem("userData"));
        const token = userData?.token;

        console.log(userData);

        if (!token || token === undefined) {
            // If no token, clear all localStorage items and exit
            localStorage.clear();

            toggleInstance.textContent = "Login";
            authToggleIcon.className = "mdi mdi-login text-muted fs-16 align-middle me-1";
            authToggleLink.href = "login.html"; // Redirect to login page
            authToggleLink.removeEventListener("click", handleLogout);
            return;
        }

        // Validate the token by hitting the /user/profile endpoint
        fetch("/user/profile", {
            method: "GET",
            headers: {
                "Authorization": `Bearer ${token}`
            }
        })
        .then(response => {
            if (!response.ok) {
                console.log('Invalid token, logging out:', response);
                localStorage.clear();
                window.location.href = "./index.html";
                return;
            }
            return response.json();
        })
        .then(profileData => {
            console.log("Profile Data:", profileData);

            // Load appropriate navbar based on userType
            if (userData?.userType) {
                let navbarFile = userData.userType === 'admin' ? 'admin-nav.html' : 'service-men-nav.html';

                // Fetch and insert the appropriate navbar HTML
                fetch(navbarFile)
                    .then(response => response.text())
                    .then(data => {
                        // Insert the navbar HTML
                        document.getElementById('navbar-container').innerHTML = data;

                        console.log("profileData before setting element",profileData)

                        // After navbar is loaded, access and update elements within it
                        const serviceNumberElement = document.getElementById('serviceNumber');
                        const departmentElement = document.getElementById('department');
                        const usernameElement = document.getElementById('user-profile-name');

                        const welcomeLoginMessage = document.getElementById('welcome-message-service-number');
                        const authToggleLink = document.getElementById('auth-toggle-link');
                        const authToggleIcon = document.getElementById('auth-toggle-icon');
                        const toggleInstance = document.getElementById('toggle-instance');

                        // Set the service number and department if they exist
                        if (profileData.serviceNumber) {
                            serviceNumberElement.textContent = profileData.serviceNumber;
                            departmentElement.textContent = `UNIT: ${profileData.department}`;
                            usernameElement.textContent = profileData.username;
                            welcomeLoginMessage.textContent = `Welcome ${profileData.serviceNumber}!`;

                            toggleInstance.textContent = "Logout";
                            authToggleIcon.className = "mdi mdi-logout text-muted fs-16 align-middle me-1";
                            authToggleLink.href = "#"; // Prevent default link behavior
                            authToggleLink.addEventListener("click", handleLogout);
                        } else {
                            serviceNumberElement.textContent = "";
                            welcomeLoginMessage.textContent = "";
                        }

                        if (profileData.department) {
                            departmentElement.textContent = `UNIT: ${profileData.department}`;
                        } else {
                            departmentElement.textContent = "";
                        }

                        if (profileData.username) {
                        } else {
                            usernameElement.textContent = "";
                        }

                        // Determine the current page URL
                        const currentPath = window.location.pathname.split('/').pop(); // Get the current page file name

                        // Select the nav links
                        const navLinks = document.querySelectorAll('.nav-link');

                        // Add 'active' class to the current link
                        navLinks.forEach(link => {
                            if (link.getAttribute('href') === currentPath) {
                                link.classList.add('active');
                            }
                        });
                    })
                    .catch(error => {
                        console.error("Error loading the navbar:", error);
                    });
            } else {
                localStorage.clear();
                console.error("User data not found or invalid in localStorage.");
                window.location.href = "./index.html";
            }
        })
        .catch(error => {
            localStorage.clear();
            console.error("Error fetching profile data:", error);
        });

        // If userData exists, update UI for logged-in state
        if (userData) {
            try {
                console.log('User is logged in. Updating UI...');
            } catch (error) {
                console.error("Error parsing userData:", error);
            }
        } else {
            console.log("No userData found in localStorage. Showing LOG IN button.");
        }
    });
    </script>
    
    
    
    <script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/libs/simplebar/simplebar.min.js"></script>
    <script src="assets/libs/node-waves/waves.min.js"></script>
    <script src="assets/libs/feather-icons/feather.min.js"></script>
    <script src="assets/js/pages/plugins/lord-icon-2.1.0.js"></script>
    <script src="assets/js/plugins.js"></script>
    
    <script src="assets/libs/simplebar/simplebar.min.js"></script>
    <script src="assets/libs/node-waves/waves.min.js"></script>
    <script src="assets/libs/feather-icons/feather.min.js"></script>
    <script src="assets/js/pages/plugins/lord-icon-2.1.0.js"></script>
    <script src="assets/js/plugins.js"></script>

    <!-- Custom scripts -->
    <script type="text/javascript"></script>
</body>


</html>